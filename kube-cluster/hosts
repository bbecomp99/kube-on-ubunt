[masters]
kmaster01.kaplaninc.com  ansible_host=10.78.103.132 ansible_user=dev

[workers]
ksscyp2kn03.kaplaninc.com ansible_host=10.78.103.120 ansible_user=dev

[all:vars]
ansible_python_interpreter=/usr/bin/python3


name: Initial setup of an Ansible "client" host.
hosts: all
#become: true
gather_facts: false

pre_tasks:

name: install python
raw: test -e /usr/bin/python || (apt -qqy update && apt install -y python)
register: output
changed_when: output.stdout != ""

name: Copy public key of Ansible master to remote hosts.
authorized_key:
user: root
key: "{{ lookup('file', ' /home/dev/.ssh/id_rsa.pub') }}"


- hosts: kubeall
  environment:
    LC_ALL: C
    LANG: C

  tasks:

  - name: install python
    raw: test -e /usr/bin/python || (apt -qqy update && apt install -y python)
    register: output
    changed_when: output.stdout != ""

  - name: Copy public key of Ansible master to remote hosts.
    authorized_key:
    user: root
    key: "{{ lookup('file', '/dev/.ssh/id_rsa.pub') }}"
~
